<!DOCTYPE html>
<html lang="en">
<head>
    <!--
        padding: 나의 내용과의 여백
        margin: 나와 외부 요소와의 여백
    -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        body{
            margin: 0;
        }
        .container{
            width: 1200px;
            height: 700px;
            background-color: blue;
        }
        .content{
            width: 1100px;
            height: 100%;
            background-image: url("/D1119/images/roller.jpeg");
            background-repeat: no-repeat;       /*패턴 반복 중지*/
            background-size: 1100px 100%;
            float: left;
            position: relative;     /* static에 left, top 적용가능한 위치속성, 즉 다른 태그와의 관계에서 할당받은 본연의 위치 */
        }
        .aside{
            width: 100px;
            height: 100%;
            background-color: aquamarine;
            float: right;
            overflow: scroll;
        }
    </style>
    <script>
        let posList = new Array();      // 좌표를 누적할 배열 선언
                                        // 현재까지는 1차원 배열이지만, 곧 좌표를 넣을 예정이므로 추후 2차원 배열이 될 예정
                                        // 프로그램이 끝날 때까지는 살아있으면서, 좌표를 누적시켜야 하므로 전역변수로 선언해야 한다.
        let txt=``;     // 문자열을 누적할 변수
        let img;        // 다른 함수에서도 접근하기 위해, 전역변수로 빼놓았다.
        let i = 0;
        let offsetX = 0;
        let offsetY = 0;

        const INNITIALPOSX = 6;
        const INITIALPOSY = 440;

        function move(){
            let x = event.clientX;  // 마우스의 x좌표
            let y = event.clientY;
            // console.log(`현재 마우스 좌표는 x=${x} y=${y}`);

            txt = txt + `x=${x}, y=${y}\n`;
            // java.util.List는 동적 요소 추가 시 add() 메서드를 사용하지만, js는 배열에 동적으로 요소를 추가할 수 있고
            // 이때 사용하는 메서드가 바로 push()이다!!
            let pos = [x, y];

            posList.push(pos);
            //posList.push(new Array(x, y));

            document.querySelector(".aside").innerText = txt;
            // 이 함수를 호출할 때마다, div 요소를 동적(=runtime 실행 시)으로 생성하여 content div 화면에 부착!!
            let dot = document.createElement("div");
            // 모든 태그는 기본이 투명이므로, 배경색을 부여하자
            dot.style.backgroundColor = "red";
            dot.style.width = "4px";
            dot.style.height = "4px";

            // 부모인 content를 기준으로 한 위치 속성인 absolute를 적용
            // 이 경우 content의 꼭지점이 dot의 0, 0 좌표가 됨
            // 단, 자식요소에 static이 아닌 position이 명시될 경우, 반드시 부모요소에도 position을 명시해야 함
            dot.style.position = "absolute";
            dot.style.left = `${x}px`;
            dot.style.top = `${y}px`;

            // 생성된 dot를 부모인 content에 동적으로 추가하자
            document.querySelector(".content").appendChild(dot);
        }

        // 문서가 로드되자마자 하고 싶은 작업이 있다면 이 함수에서 처리하기 위해 onLoad 시점에 호출됨
        function init() {
            // 프로그래밍적으로 동적으로 생성하려면 createElement() 메서드 사용해야 함.
            img = document.createElement("img");
            img.src = "/D1119/images/rollercoasterCart.png";
            // html 태그요소는 개발자가 특별히 position을 명시하지 않으며 디폴트가 static이므로,
            // left, top이 적용되지 않으므로 왼쪽 상단을 기준으로 부착된다..
            // 따라서 위치를 자유롭게 하고 싶다면 개발자는 css의 position을 명시할 수 있다.
            // 1) absolute: 부모 요소를 기준으로 한 위치 속성
            // 2) relative: 현재 자신의 본연의 위치를 기준으로 한 위치 속성
            // 현재 캐릭터는 부모인 content div를 기준으로 위치를 지정할 것이므로, absolute로 지정해야 한다.
            img.style.position = "absolute";
            img.style.left = INNITIALPOSX + "px";
            img.style.top = INITIALPOSY + "px";
            img.style.width = 60 + "px";
            offsetX = img.width / 2;
            offsetY = img.height / 2;

            //부모 요소를 content로 두고, 그 안에 자식으로 부착
            document.querySelector(".content").appendChild(img);
        }
        // 문서 내의 content 영역안에 존재하는 마리오 이미지의 위치를 누적된 좌표를 대상으로
        // 순서대로 접근해보자
        function sizeWithoutPX(str) {
            return Number.parseInt(str.substring(0, str.lastIndexOf("p")));
        }

        function manual() {
            if(i == posList.length) return;
            
            let directionX = posList[i][0] - (sizeWithoutPX(img.style.left) + offsetX);
            let directionY = posList[i][1] - (sizeWithoutPX(img.style.top) + offsetY);
            let sign = directionY < 0 ? -1 : 1;
            let radian =  Math.acos(directionX / (Math.sqrt(Math.pow(directionX, 2) + Math.pow(directionY, 2))));
            let degree = radian * (180 / Math.PI) * sign;
            console.log("directionX " + directionX);
            console.log("directionY " + directionY);
            console.log("radian " + radian);
            console.log("degree " + degree);
            //let angle = 
            
            img.style.transform = `rotate(${degree}deg)`;
            
            img.style.left = posList[i][0] - offsetX + "px";
            img.style.top = posList[i][1] - offsetY + "px";
            i++;
        }
        function auto() {
            setInterval(manual, 100);
            // 엉킴을 방지하기 위해 버튼을 비활성화 시키자
            // 문서 내의 자동 버튼을 비활성화 시키자
        }
        function reload(){
            i =0;
            img.style.left = INNITIALPOSX + "px";
            img.style.top = INITIALPOSY + "px";
        }
    </script>
</head>
<body onLoad="init()">
    <div class="container">
        <div class="content" onmousedown="move()">
        </div>
        <div class="aside"></div>
        <button onclick="manual()">수동</button>
        <button onclick="auto()" id="bt_auto">자동</button>
        <button onclick="reload()" id = "bt_reload">재시작</button>
    </div>
</body>
</html>